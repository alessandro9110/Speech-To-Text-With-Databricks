# This is a Databricks asset bundle definition for speech_to_text_asset_bundle.
# See https://docs.databricks.com/dev-tools/bundles/index.html for documentation.
bundle:
  name: speech_to_text_asset_bundle
  uuid: 7c8f3a2e-9d4b-4e1f-a6c5-8b2d7e9f1a3c

include:
  - resources/*.yml
  - resources/*/*.yml

artifacts:
  python_artifact:
    type: whl
    build: uv build --wheel


# Variable declarations. These variables are assigned in the dev/prod targets below.
variables:
  catalog:
    description: The catalog to use for Speech To Text With Databrikcs solution.
    default: speech_to_text
  schema:
    description: The catalog to use for Speech To Text With Databrikcs solution.
    default: default
  service_principal_id:
    description: The Application ID (UUID) of the service principal for production


# Targets define different deployment environments (dev, prod, etc.) with their specific configurations.
# Each target can have different settings for run_as, presets, variables, and resource definitions.
# Use 'databricks bundle deploy --target <target_name>' to deploy to a specific environment.
targets:
  dev:
    # See also https://docs.databricks.com/dev-tools/bundles/deployment-modes.html.

    run_as:
      service_principal_name: ${var.service_principal_id}
    
    mode: development
    default: true

    presets:
      name_prefix: ${workspace.current_user.short_name}_
      pipelines_development: true # set development to true for pipelines
      trigger_pause_status: PAUSED # set pause_status to PAUSED for all triggers and schedules
      jobs_max_concurrent_runs: 10 # set max_concurrent runs to 10 for all jobs
      tags:
        department: finance     

    # Note: workspace.host is not specified here because the bundle automatically uses the workspace where the code is deployed (based on your Databricks CLI profile or current context)
    workspace:
      #host
      root_path: ~/Shared/.bundle/${bundle.name}/${bundle.target}

            # define resouces like: schemas etc.
    resources:
      schemas:
        dev:
          name: ${var.schema}
          catalog_name: ${var.catalog}
          comment: 'Schema for development of speech to text'
    

  prod:
    presets:
      name_prefix: 'prod_' 
      pipelines_development: false # set development to true for pipelines
      trigger_pause_status: PAUSED # set pause_status to PAUSED for all triggers and schedules
      jobs_max_concurrent_runs: 10 # set max_concurrent runs to 10 for all jobs
      tags:
        department: finance

    mode: production

    # Note: workspace.host is not specified here because the bundle automatically uses the workspace where the code is deployed (based on your Databricks CLI profile or current context)
    workspace:
      #host
      root_path: ~/Shared/.bundle/${bundle.name}/${bundle.target}

    variables:
      catalog: speech_to_text
      schema: prod
    
        # define resouces like: schemas etc.
    resources:
      schemas:
        prod:
          name: prod
          catalog_name: speech_to_text
          comment: 'Schema for development'
          
    
    #permissions:
     # - user_name: ${var.admin_user_email}
      #  level: CAN_MANAGE
